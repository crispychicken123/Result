<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crispy Chicken ‚Äì Sales Comparison System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#b30000}
select,input{padding:6px;margin:5px}
table{border-collapse:collapse;width:100%;margin-top:15px;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#333;color:#fff}
.diff-pos{background:#c6efce}
.diff-neg{background:#ffc7ce}
</style>
</head>

<body>

<h2>üçó Crispy Chicken ‚Äì Sales Difference System</h2>

<label>Branch:</label>
<select id="branch">
  <option>Crispy Chicken-Hamdan St</option>
  <option>Crispy Chicken Khaldia</option>
  <option>Crispy Chicken Shabiya 11</option>
  <option>Crispy Chicken Muroor</option>
  <option>Crispy Chicken Al Electra</option>
  <option>Crispy Chicken Al Barsha</option>
  <option>Crispy Chicken Al Satwa</option>
  <option>Crispy Chicken Al Rigga</option>
  <option>Crispy Chicken Al Majaz</option>
</select>

<br><br>

<label>POS Excel:</label>
<input type="file" id="posFile">

<label>Platform Excel:</label>
<input type="file" id="platFile">

<button onclick="process()">Compare</button>

<table id="result">
<thead>
<tr>
  <th>Recipe</th>
  <th>POS Qty</th>
  <th>Platform Qty</th>
  <th>Difference</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// üîÅ Recipe Mapping
const recipeMap = {
  "daily spicy meal":"Daily Spicy Meal",
  "daily spicy meal noon":"Daily Spicy Meal",
  "daily offer spicy meal":"Daily Spicy Meal",

  "daily original meal":"Daily Original Meal",
  "daily original meal noon":"Daily Original Meal",
  "daily offer original meal":"Daily Original Meal",

  "ultimate spicy":"Ultimate Spicy",
  "ultimate s noon offers":"Ultimate Spicy",

  "ultimate original":"Ultimate Original",
  "ultimate o noon offers":"Ultimate Original"
};

let posData={}, platData={};

function normalize(name){
  name = name.toLowerCase().trim();
  return recipeMap[name] || name;
}

function readExcel(file, callback){
  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result,{type:"binary"});
    const sheet = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
    callback(sheet);
  };
  reader.readAsBinaryString(file);
}

function process(){
  readExcel(posFile.files[0], pos => {
    pos.forEach(r=>{
      let key = normalize(r.Name || r.Item);
      posData[key] = (posData[key]||0) + Number(r["Qty Sold"]||0);
    });

    readExcel(platFile.files[0], plat => {
      plat.forEach(r=>{
        let key = normalize(r.Name || r.Item);
        platData[key] = (platData[key]||0) + Number(r["Qty Sold"]||0);
      });

      render();
    });
  });
}

function render(){
  const tbody = document.querySelector("#result tbody");
  tbody.innerHTML="";
  const all = new Set([...Object.keys(posData),...Object.keys(platData)]);

  all.forEach(k=>{
    const p = posData[k]||0;
    const pl = platData[k]||0;
    const d = p-pl;
    tbody.innerHTML += `
      <tr class="${d<0?'diff-neg':'diff-pos'}">
        <td>${k}</td>
        <td>${p}</td>
        <td>${pl}</td>
        <td>${d}</td>
      </tr>`;
  });
}
</script>

</body>
</html>
