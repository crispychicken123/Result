<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>POS vs Inventory Excel Compare</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body { font-family: Arial; background:#f4f4f4; padding:20px }
table { border-collapse: collapse; width:100%; background:#fff; margin-top:10px }
th, td { border:1px solid #ccc; padding:6px; text-align:center }
th { background:#333; color:#fff }
.ok { background:#c8e6c9 }
.warn { background:#fff9c4 }
.bad { background:#ffcdd2 }
input { width:95% }
</style>
</head>

<body>

<h2>üìä POS vs Inventory (Excel Upload)</h2>

<!-- Mapping -->
<h3>1Ô∏è‚É£ Item Mapping</h3>
<table id="mapTable">
<tr><th>POS Item</th><th>Unified Item</th></tr>
<tr><td><input value="Daily MIX Meal"></td><td><input value="MIX MEAL"></td></tr>
<tr><td><input value="Daily MIX Meal Noon"></td><td><input value="MIX MEAL"></td></tr>
<tr><td><input value="BUCKET MEAL MIX"></td><td><input value="MIX MEAL"></td></tr>
<tr><td><input value="ULTIMATE Spicy"></td><td><input value="ULTIMATE"></td></tr>
<tr><td><input value="Ultimate S Noon Offers"></td><td><input value="ULTIMATE"></td></tr>
</table>

<hr>

<!-- Upload -->
<h3>2Ô∏è‚É£ Upload Excel Files</h3>
POS Excel:
<input type="file" id="posFile"><br><br>
Report Excel:
<input type="file" id="repFile"><br><br>

<button onclick="process()">üîç Compare</button>

<!-- Result -->
<h3>3Ô∏è‚É£ Result</h3>
<table id="result">
<tr><th>Unified Item</th><th>POS Qty</th><th>Report Qty</th><th>Difference</th></tr>
</table>

<script>
let posData = [], repData = [];

function readExcel(file, callback) {
  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result, {type:'binary'});
    const sheet = wb.Sheets[wb.SheetNames[0]];
    callback(XLSX.utils.sheet_to_json(sheet));
  };
  reader.readAsBinaryString(file);
}

document.getElementById("posFile").addEventListener("change", e=>{
  readExcel(e.target.files[0], d => posData = d);
});

document.getElementById("repFile").addEventListener("change", e=>{
  readExcel(e.target.files[0], d => repData = d);
});

function getMapping(){
  let map = {};
  document.querySelectorAll("#mapTable tr").forEach((r,i)=>{
    if(i>0){
      let i1 = r.cells[0].querySelector("input").value.trim();
      let i2 = r.cells[1].querySelector("input").value.trim();
      map[i1] = i2;
    }
  });
  return map;
}

function process(){
  const map = getMapping();
  let posSum = {}, repSum = {};

  posData.forEach(r=>{
    let name = r.Item;
    let qty = Number(r["Qty Sold"]) || 0;
    let u = map[name] || name;
    posSum[u] = (posSum[u] || 0) + qty;
  });

  repData.forEach(r=>{
    let name = r.Item;
    let qty = Number(r["Qty Sold"]) || 0;
    repSum[name] = (repSum[name] || 0) + qty;
  });

  const table = document.getElementById("result");
  table.innerHTML = "<tr><th>Unified Item</th><th>POS Qty</th><th>Report Qty</th><th>Difference</th></tr>";

  Object.keys(posSum).forEach(k=>{
    let diff = posSum[k] - (repSum[k] || 0);
    let cls = diff===0 ? "ok" : Math.abs(diff)<=5 ? "warn" : "bad";
    table.innerHTML += `
      <tr class="${cls}">
        <td>${k}</td>
        <td>${posSum[k]}</td>
        <td>${repSum[k] || 0}</td>
        <td>${diff}</td>
      </tr>`;
  });
}
</script>

</body>
</html>
